---
import Icons from "@/icons/Icons.astro";
import Logo from "../../icons/Logo.astro";
import ModeToggle from "./ModeToggle.astro";
---

<header class="sticky top-0 z-50 w-full border-b-2 border-foreground bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60">
  <div class="flex h-16 items-center px-6">
    <!-- Branding -->
    <div class="mr-8 flex items-center gap-2">
      <a data-astro-prefetch href="/" class="flex items-center gap-2 group">
        <div class="bg-[#F2F2F0] p-1">
          <Logo class="h-6 w-6" fill="currentColor" />
        </div>
        <div class="flex flex-col">
          <span
            class="font-display text-xl font-black tracking-tighter transition-colors"
          >
            <span class="group-hover:text-[#10B981]">HAPPY</span><span
              class="text-primary"
            >FMT</span>
          </span>
          <span class="text-xs text-muted-foreground lowercase leading-none">
            by happytoolin
          </span>
        </div>
      </a>
      <span
        class="hidden md:inline-block text-[10px] font-bold bg-foreground text-background px-1 py-0.5 ml-2"
      >V2.0</span>
      <span
        class="hidden md:inline-block text-xs text-muted-foreground lowercase ml-2"
      >
        by happytoolin
      </span>
    </div>

    <!-- Navigation (Desktop) -->
    <nav class="hidden md:flex items-center gap-6 text-xs font-bold tracking-widest uppercase">
      <a
        href="/javascript"
        class="hover:text-primary hover:underline decoration-2 underline-offset-4"
      >JS/TS</a>
      <a
        href="/css"
        class="hover:text-primary hover:underline decoration-2 underline-offset-4"
      >CSS</a>
      <a
        href="/json"
        class="hover:text-primary hover:underline decoration-2 underline-offset-4"
      >JSON</a>
      <a
        href="/sql"
        class="hover:text-primary hover:underline decoration-2 underline-offset-4"
      >SQL</a>
      <a
        href="/python"
        class="hover:text-primary hover:underline decoration-2 underline-offset-4"
      >Python</a>
      <a
        href="#more-tools"
        class="opacity-50 hover:opacity-100 hover:text-primary"
      >+ More</a>
    </nav>

    <!-- Actions -->
    <div class="ml-auto flex items-center gap-4">
      <div class="hidden md:flex items-center gap-2 text-[10px] text-muted-foreground font-mono border border-border px-2 py-1">
        <span class="w-2 h-2 rounded-full bg-accent animate-pulse"></span>
        SYSTEM: ONLINE
      </div>
      <ModeToggle />
    </div>
  </div>
</header>

<!-- Mobile Menu -->
<div
  class="md:hidden fixed inset-0 z-50 bg-background/95 backdrop-blur hidden"
  role="dialog"
  aria-modal="true"
  id="mobile-menu"
>
  <div class="fixed inset-y-0 right-0 z-50 w-full overflow-y-auto bg-background border-l-2 border-foreground">
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between p-4 border-b-2 border-foreground">
        <a data-astro-prefetch href="/" class="flex items-center gap-2 group">
          <div class="bg-[#F2F2F0] p-1">
            <Logo class="h-6 w-6" fill="currentColor" />
          </div>
          <div class="flex flex-col">
            <span
              class="font-display text-xl font-black tracking-tighter transition-colors"
            >
              <span class="group-hover:text-[#10B981]">HAPPY</span><span
                class="text-primary"
              >FMT</span>
            </span>
            <span class="text-xs text-muted-foreground lowercase leading-none">
              by happytoolin
            </span>
          </div>
        </a>
        <button
          type="button"
          class="p-2 border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          id="close-menu-button"
        >
          <Icons icon="cross" />
        </button>
      </div>

      <div class="flex-1 p-4">
        <div class="space-y-2">
          <a
            href="/javascript"
            class="block px-4 py-3 font-bold text-xs uppercase tracking-widest border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          >JS/TS</a>
          <a
            href="/css"
            class="block px-4 py-3 font-bold text-xs uppercase tracking-widest border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          >CSS</a>
          <a
            href="/json"
            class="block px-4 py-3 font-bold text-xs uppercase tracking-widest border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          >JSON</a>
          <a
            href="/sql"
            class="block px-4 py-3 font-bold text-xs uppercase tracking-widest border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          >SQL</a>
          <a
            href="/python"
            class="block px-4 py-3 font-bold text-xs uppercase tracking-widest border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          >Python</a>
          <a
            href="#more-tools"
            class="block px-4 py-3 font-bold text-xs uppercase tracking-widest border-2 border-foreground opacity-50 hover:opacity-100 transition-colors"
          >+ More</a>
        </div>
      </div>

      <div class="p-4 border-t-2 border-foreground">
        <ModeToggle />
      </div>
    </div>
  </div>
</div>

<script>
const menuButton = document.getElementById("menu-button");
const mobileMenu = document.getElementById("mobile-menu");
const closeMenuButton = document.getElementById("close-menu-button");

// Add menu button for mobile if it doesn't exist
if (!menuButton) {
  const header = document.querySelector("header .flex");
  const mobileMenuBtn = document.createElement("button");
  mobileMenuBtn.id = "menu-button";
  mobileMenuBtn.className =
    "md:hidden flex items-center gap-2 text-[10px] font-mono border border-border px-2 py-1 hover:bg-primary hover:text-black transition-colors";
  mobileMenuBtn.innerHTML = `
    <span class="w-2 h-2 rounded-full bg-accent animate-pulse"></span>
    MENU
  `;
  header?.querySelector(".ml-auto")?.insertBefore(
    mobileMenuBtn,
    header?.querySelector(".ml-auto")?.firstChild as Node | null,
  );

  mobileMenuBtn.addEventListener("click", function() {
    mobileMenu?.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  });
}

if (!mobileMenu || !closeMenuButton) {
  throw new Error("Could not find all elements");
}

closeMenuButton.addEventListener("click", function() {
  mobileMenu.classList.add("hidden");
  document.body.style.overflow = "";
});
</script>

<script is:inline>
const getModePreference = () => {
  if (typeof localStorage !== "undefined" && localStorage.getItem("mode")) {
    return localStorage.getItem("mode");
  }
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};
const isDark = getModePreference() === "dark";
document.documentElement.classList[isDark ? "add" : "remove"]("dark");

if (typeof localStorage !== "undefined") {
  const observer = new MutationObserver(() => {
    const isDark = document.documentElement.classList.contains("dark");
    localStorage.setItem("mode", isDark ? "dark" : "light");
  });
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ["class"],
  });
}

const getInitialTheme = () => {
  if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
    return localStorage.getItem("theme");
  }
  return "rose-pine";
};
const theme = getInitialTheme();
document.documentElement.setAttribute("data-theme", theme);
</script>
