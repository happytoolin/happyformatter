---
import Logo from "../../icons/Logo.astro";
import ThemeIcon from "../ThemeIcon.astro";
---

<header class="group sticky top-0 z-50 w-full border-b-2 border-foreground bg-background/80 backdrop-blur-md">
  <div class="container mx-auto px-4 h-16 flex items-center justify-between">
    <!-- Branding -->
    <a href="/" class="flex items-center gap-3 group">
      <div class="bg-primary text-black p-1 transition-transform group-hover:rotate-180 duration-500">
        <Logo class="h-8 w-8" fill="currentColor" />
      </div>
      <div class="flex flex-col leading-none">
        <span class="font-display text-2xl font-black tracking-tighter">
          HAPPY<span class="text-accent">FMT</span>
        </span>
        <span
          class="font-mono text-[10px] uppercase tracking-widest text-muted-foreground"
        >
          v2.0 // BY HAPPYTOOLIN
        </span>
      </div>
    </a>

    <!-- Desktop Nav: Brutalist Links -->
    <nav
      class="hidden md:flex items-center gap-8"
      aria-label="Language navigation"
    >
      {["javascript", "css", "json", "sql", "python"].map((lang) => (
        <a
          href={`/${lang}`}
          class="font-mono text-sm font-bold uppercase hover:text-primary transition-colors relative group"
          aria-label={`Format ${lang} code`}
        >
          <span
            class="opacity-0 group-hover:opacity-100 absolute -left-3 text-accent"
            aria-hidden="true"
          >/</span>
          {lang}
        </a>
      ))}
    </nav>

    <!-- Actions -->
    <div class="flex items-center gap-4">
      <a
        href="#more-tools"
        class="hidden md:block font-display text-sm uppercase border-b-2 border-transparent hover:border-primary"
      >
        All Modules
      </a>
      <div class="h-8 w-[2px] bg-foreground/20 hidden md:block"></div>
      <ThemeIcon />
      <!-- Mobile Menu Button -->
      <button
        id="menu-button"
        class="md:hidden flex items-center gap-2 text-[10px] font-mono border-2 border-foreground px-2 py-1 hover:bg-primary hover:text-black transition-colors relative z-[55]"
        aria-controls="mobile-menu"
        aria-expanded="false"
        aria-label="Open navigation menu"
      >
        <span
          class="w-2 h-2 rounded-full border border-accent animate-pulse"
          aria-hidden="true"
        ></span>
        MENU
      </button>
    </div>
  </div>

  <!-- Running Tape / Decoration -->
  <div class="absolute bottom-0 left-0 w-full h-[2px] bg-gradient-to-r from-accent via-primary to-accent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
  </div>
</header>

<!-- Mobile Menu -->
<div
  class="md:hidden fixed inset-0 z-[60] bg-background/95 backdrop-blur hidden"
  role="dialog"
  aria-modal="true"
  aria-labelledby="mobile-menu-title"
  id="mobile-menu"
>
  <div
    class="fixed inset-y-0 right-0 z-50 w-full overflow-y-auto bg-background border-l-2 border-foreground"
    role="document"
  >
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between p-4 border-b-2 border-foreground">
        <h2 id="mobile-menu-title" class="sr-only">Navigation Menu</h2>
        <a href="/" class="flex items-center gap-3 group">
          <div class="bg-primary text-black p-1">
            <Logo class="h-6 w-6" fill="currentColor" />
          </div>
          <div class="flex flex-col leading-none">
            <span class="font-display text-xl font-black tracking-tighter">
              HAPPY<span class="text-accent">FMT</span>
            </span>
            <span
              class="font-mono text-[8px] uppercase tracking-widest text-muted-foreground"
            >
              v2.0 // BY HAPPYTOOLIN
            </span>
          </div>
        </a>
        <button
          type="button"
          class="p-2 border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
          id="close-menu-button"
          aria-label="Close navigation menu"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="flex-1 p-4">
        <nav aria-label="Mobile language navigation">
          <div class="space-y-2">
            {["javascript", "css", "json", "sql", "python"].map((lang) => (
              <a
                href={`/${lang}`}
                class="block px-4 py-3 font-mono text-sm font-bold uppercase border-2 border-foreground hover:bg-primary hover:text-black transition-colors"
                aria-label={`Format ${lang} code`}
              >{lang}</a>
            ))}
          </div>
        </nav>
        <nav aria-label="Additional tools">
          <a
            href="#more-tools"
            class="block mt-4 px-4 py-3 font-display text-sm uppercase border-2 border-foreground opacity-50 hover:opacity-100 transition-colors"
          >All Modules</a>
        </nav>
      </div>

      <div class="p-4 border-t-2 border-foreground">
        <ThemeIcon />
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const menuButton = document.getElementById("menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const closeMenuButton = document.getElementById("close-menu-button");

  menuButton?.addEventListener("click", function(e) {
    e.preventDefault();
    e.stopPropagation();
    mobileMenu?.classList.remove("hidden");
    document.body.style.overflow = "hidden";
    // Update ARIA attributes
    menuButton.setAttribute("aria-expanded", "true");
    // Focus management: move focus to close button
    closeMenuButton?.focus();
  });

  closeMenuButton?.addEventListener("click", function(e) {
    e.preventDefault();
    e.stopPropagation();
    mobileMenu?.classList.add("hidden");
    document.body.style.overflow = "";
    // Update ARIA attributes
    menuButton?.setAttribute("aria-expanded", "false");
    menuButton?.setAttribute("aria-label", "Open navigation menu");
    // Return focus to menu button
    menuButton?.focus();
  });

  // Close menu on Escape key
  document.addEventListener("keydown", function(event) {
    if (event.key === "Escape" && !mobileMenu?.classList.contains("hidden")) {
      closeMenuButton?.click();
    }
  });

  // Close menu when clicking outside
  mobileMenu?.addEventListener("click", function(event) {
    if (event.target === mobileMenu) {
      closeMenuButton?.click();
    }
  });
});
</script>
