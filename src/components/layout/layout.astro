---
import { ViewTransitions } from "astro:transitions";
import { generatePageTitle } from "../../lib/seo-titles";
import { generateBreadcrumbs, getLanguageSEOData } from "../../lib/seo-utils";
import "../../styles/globals.css";
import MoreTools from "../info/moretools.astro";
import RelatedTools from "../info/RelatedTools.astro";
import VariantLinks from "../info/VariantLinks.astro";
import Breadcrumbs from "../structured-data/Breadcrumbs.astro";
import FAQSchema from "../structured-data/FAQSchema.astro";
import WebApplicationSchema from "../structured-data/WebApplicationSchema.astro";
import Footer from "./Footer.astro";
import FormatHeading from "./FormatHeading.astro";
import Head from "./Head.astro";
import Header from "./header.astro";

type Props = {
  title: string;
  description: string;
  language?: string;
  image?: string;
  minify?: boolean;
  breadcrumbs?: Array<{ name: string; url: string }>;
  currentVariant?: string | null;
  keywords?: string;
  category?: string;
};

const {
  title,
  description,
  image,
  language,
  minify,
  breadcrumbs = [],
  currentVariant = null,
  keywords,
  category,
} = Astro.props;

// Get language-specific SEO data
const seoData = getLanguageSEOData(language, minify);

const pageTitle = generatePageTitle(language, currentVariant, minify);
const finalBreadcrumbs = breadcrumbs.length > 0
  ? breadcrumbs
  : generateBreadcrumbs(language, minify);
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <Head
      title={pageTitle}
      description={seoData.description}
      image={image}
      keywords={keywords || seoData.keywords}
      category={category || seoData.category}
    />
    <ViewTransitions />

    <!-- Structured Data -->
    <WebApplicationSchema language={language} />

    <!-- Breadcrumbs Schema -->
    {language && <Breadcrumbs items={finalBreadcrumbs} />}

    <!-- FAQ Schema for language pages -->
    {language && <FAQSchema language={language} />}
  </head>
  <body>
    <!-- Skip to main content link for keyboard navigation -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 bg-primary text-primary-foreground px-4 py-2 rounded-md z-[100] focus:outline-none focus:ring-2 focus:ring-ring"
    >
      Skip to main content
    </a>

    <Header />

    <!-- Visual Breadcrumbs -->
    {language && (
      <nav aria-label="Breadcrumb" class="py-4 px-4">
        <ol class="flex items-center space-x-2 text-sm text-muted-foreground max-w-6xl mx-auto">
          <li>
            <a
              href="/"
              class="hover:text-foreground transition-colors duration-200 hover:underline"
            >
              Home
            </a>
          </li>
          <li class="text-foreground/40">/</li>
          <li class="text-foreground font-medium">
            {pageTitle}
          </li>
        </ol>
      </nav>
    )}

    <main id="main-content" role="main">
      {language && (
        <FormatHeading language={language} minify={minify ?? false} />
      )}
      <slot />
    </main>

    <RelatedTools currentLanguage={language} minify={minify} />
    {language && (
      <VariantLinks
        currentLanguage={language}
        currentVariant={currentVariant}
      />
    )}
    <MoreTools />
    <Footer />
  </body>
</html>
